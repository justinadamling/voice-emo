[build]
builder = "nixpacks"

[nixpacks]
setup = ["python311", "gcc", "ffmpeg", "portaudio19-dev", "python3-dev", "pkg-config", "libasound2-dev"]
install = ["python -m pip install --upgrade pip", "pip install --no-cache-dir wheel setuptools", "pip install --no-cache-dir -r requirements.txt"]

# Specify the source directory
[build.copy]
source = "src"
destination = "/app/src"

[deploy]
startCommand = "uvicorn src.api:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10 